{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block html_head %}
{% load static %}
<link rel="stylesheet" href="{% static 'npl/c3.min.css' %}" />
<script src="https://d3js.org/d3.v5.min.js"></script>

<script src="{% static 'npl/c3.min.js' %}"></script>
{% endblock %}

{% block content %}

<h2>Dashboard</h2>
<h3>Response Distribution</h3>
<div id="response_percentages_chart"></div>
<br />
<h3>Encounters over the last 4 weeks</h3>
<div id="encounters_over_time_chart"></div>


{% endblock %}

{% block scripts %}
<script>
// Color scheme from https://coolors.co/658fca-d00000-ffba08-032b43-136f63
var json = {{ django_json|safe }}
var chart1 = c3.generate({
    bindto: '#response_percentages_chart',
    data: {
        colors: {
            'RL': '#D00000',
            'YL': '#FFBA08',
            'GL': '#136F63',
            'WT': '#658FCA',
            'RT': '#032B43',
        },
        columns: [
            ['RL', json.num_red_lights],
            ['YL', json.num_yellow_lights],
            ['GL', json.num_green_lights],
            ['WT', json.num_believer_wants_training],
            ['RT', json.num_believer_rejects_training],
        ],
        type : 'donut',
        onclick: function (d, i) { console.log("onclick", d, i); },
    },
});
// future: can make this into stacked bar chart
var encounters_by_week_obj = {{ encounters_by_week|safe }}
var num_encounters_by_week = encounters_by_week_obj.num_encounters
var num_red_lights_by_week = encounters_by_week_obj.num_red_lights

var num_encounters = ['Number of Encounters']
var num_red_lights = ['Number of Red Lights']

for (var i=0; i<num_encounters_by_week.length; i++) {
    num_encounters.push(num_encounters_by_week[i])
    num_red_lights.push(num_red_lights_by_week[i])
}
var chart2 = c3.generate({
    bindto: '#encounters_over_time_chart',
    data: {
        columns: [
            num_encounters,
            num_red_lights,
        ],
        type: 'bar',
        groups: [
            ['num_encounters', 'num_red_lights']
        ]
    },
    grid: {
        y: {
            lines: [{value:0}]
        }
    }
});

</script>
{% endblock %}
